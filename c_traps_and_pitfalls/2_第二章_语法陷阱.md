[TOC]

# 第二章 语法陷阱

## 2.1 理解函数声明

- C 变量的声明
  - 一般形式：包含两个部分，分别是
    - 类型
    - 一组类似表达式的声明符
  - 示例
    - float f, g;
    - float ((f));  // 由于 ((f)) 为 float 类型，所以 f 也为 float 类型

- C 函数的声明（同样符合 C 变量的声明逻辑）
  - 示例
    - float ff();  // 表达式 ff() 的求值结果为 float，即函数的返回值为 float 类型
    - float *pf;  // 表达式 *pf 的求职结果为 float，即 pf 为指向 float 类型的指针
    - float *g();  // 注：() 的优先级高于 *
    - float (*h)();  // h 是一个指针，指向的是一个函数，该函数没有参数且返回值为 float 类型
    - float (*f)(int);
  - 示例
    - (*(void(*)())0)()
      - 如果 fp 是一个函数指针
        - 那么 \*fp 就是该指针指向的函数，(\*fp)() 就是调用该函数的方式
        - ==fp() 是 (\*fp)() 的简写形式==
      - 上式可以改写为
        - typedef void (\*funcptr) ();
        - (\* (funcptr)0) ();
    - void (\*signal(int, void(\*)(int))) (int);
      - 上式可以改写为
        - typedef void (*HANDLER) (int);
        - HANDLER signal(int, HANDLER);

> 一旦知道了如何声明一个给定类型的变量，那么该类型的类型转换符就很容易得到了：只需要把声明中的变量名和声明末尾的分号去掉，再将剩余部分用一个括号整个 “括起来” 即可。

## 2.2 运算符的优先级问题

> 用括号可以避免优先级错误的问题，但是表达式中有了太多的括号反而不容易理解。因此，记住 C 语言中运算符的优先级是有益的。

优先级 | 运算符 | 结合性 |  分组  |  备注
:---: | :---:  |  :---:  |  :---:  |  :---:  
1  |  ()  []  ->  .  |  自左向右  |  1  |  ()为函数调用运算符
2  |  !  ~  ++  --  -  (type)  *  &  sizeof  |  自==右==向左  |  2  |  ++为自增运算符，--为自减运算符，(type)为强制类型转换，-为负号运算符，*为解引用运算符，&为取地址运算符
3  |  *  /  %  |  自左向右  |  3  | 算数运算符
4  |  +  -  |  自左向右  |  ^  | ^
5  |  <<  >>  |  自左向右  |  4  |  移位运算符
6  |  <  <=  >  >=  |  自左向右  |  5  |  关系运算符
7  |  ==  !=  |  自左向右  |  ^ | ^
8  |  &  |  自左向右  |  6  |  位运算符
9  |  '^'  |  自左向右  |  ^  |  ^
10  |  \|  |  自左向右  |  ^  |  ^
11  |  &&  |  自左向右  |  7  |  逻辑运算符
12  |  \|\|  |  自左向右  |  ^  |  ^
13  |  ?:  |  自==右==向左  |  8  |  条件表达式
14  |  assignments  |  自==右==向左  |  9  |  赋值运算符
15  |  ,  |  自左向右  |  10  |  逗号运算符

- 注1：
  - 由上至下，优先级依次递减
  - 结合性：当一个==运算对象==两侧运算符的==优先级别相同==时, ==运算对象==与运算符的结合顺序
- 注2：
  - 优先级最高的并不是真正意义上的运算符
  - 单目运算符的优先级仅次于前述运算符
  - 双目运算符优先级低于单目运算符，双目运算符的优先级依次为
    - ==算==数运算符
    - ==移==位运算符
    - ==关==系运算符
    - ==位==运算符
    - ==逻==辑运算符
  - 三目运算符
  - 赋值运算符
  - 逗号运算符

## 2.3 注意作为语句结束标志的分号

- 在 `if` 或者 `while` 语句之后需要紧跟一条语句时，如果此时多了一个分号；
- return 语句后面遗漏了一个分号（并且下一行还有内容）；
- 声明结尾后面遗漏了一个分号（并且声明后面紧跟一个函数定义）。

## 2.4 switch语句

- C 语言把 case 标号当作真正意义上的标号，因此程序的控制流会径直通过 case 标号，而不会受到任何影响
  - 优势：程序控制流更加灵活；
  - 劣势：遗漏 case 后的 break 导致控制流出错。

## 2.5 函数调用

- C 语言要求：在函数调用时即使函数不带参数，也应该包括参数列表
  ```C
  // f 是一个函数
  f();  // 函数调用
  f;  // 计算函数 f 的地址
  ```

## 2.6 "悬挂"else引发的问题

- 语法规则：`else` 始终与同一对括号内的最近的未匹配的 `if` 结合